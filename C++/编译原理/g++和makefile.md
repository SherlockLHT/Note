# 一、gcc和g++

gcc和g++ 都是GUN 的c/c++ 编译器，实际上，两款编译器都能编译c和c++的代码

在使用 g++ 编译的时候，也是先调用 gcc 进行编译，然后使用 g++ 链接的

对于网上的一些错误说法，大概整理如下：

**错误1、gcc是C语言编译器，g++ 是 C++ 编译器**

两个编译器都能够编译C/C++

首先，要了解的是，C 和 C++ 的语法是有所区别的，虽然说，C++ 是C语言的超集，但是C++ 的语法比C语言更严谨一些，代码能使用C语言的原语法编译，不一定能使用C++ 的语语法编译过。

其次，gcc会根据文件额后缀名（.c/.cpp）区分C和C++，而g++ 则全部当成C++ 来处理

**错误2、gcc不会定义__cplusplus宏**

***__cplusplus*** 宏的作用是标志编译器是按照C语言还是C++ 的语法来编译，而gcc不是不能编译c++ 代码，它会根据代码文件的后缀名区分C和C++，即.c文件按照C的语法编译，.cpp文件按照c++的语法编译。所以，如果是.cpp文件，gcc是会定义 ***__cplusplus*** 宏的

**错误3、只能用gcc编译，用g++链接**

g++ 也能编译，只是也是调用gcc罢了；而gcc也能链接，可以使用 **gcc -lstdc++** 指令完成。只是gcc不能自动和c++ 使用的库链接，所以，一般使用g++  连完成链接，但是编译阶段，gcc 和g++ 是等价的

**错误4、extern "C" 会对gcc/g++造成影响**

首先要了解 **extern "C"** 的作用，由于历史原因，c++  需要兼容c，c不支持重载，编译c的函数时，不会带上函数的参数类型，一般只包含函数名，但是c++ 支持重载，编译c++ 时就需要带上函数的参数类型，所以出现冲突。而为了在c++ 代码中兼容c代码，则需要告诉编译器，该段代码需要按照c的语法来编译。具体的用法请参考相关文章。

所以，无论是gcc，还是g++，在遇到 **extern "C"** 时，都会按照C语言的语法来编译

# 二、g++的用法

g++的安装过程跳过不提，[MinGW套件](https://sourceforge.net/projects/mingw/)

## 1、编译步骤和g++指令参数

想要了解g++的用法，必须先要了解代码从文件到可执行文件的构建过程，整个构建大致分为四步：

1. 预编译；
2. 转换成汇编；
3. 编程成中间文件（机器语言）；
4. 链接，生成可执行的二进制文件；

g++在各个阶段均有对应的指令，假设代码文件为：main.cpp

需要注意的是，头文件只起到声明的作用，所以编译参数选择的文件都是源文件

### （1）预编译 -E

​	预编译主要有几步：

1. 先将宏定义展开，完成后，代码中将不会出现宏定义；
2. 使用文件内容替换 **#include**；
3. 进行条件编译的选择，即 **#if** 等；

使用 **-E** 参数指定代码文件完成预编译

```
g++ -E main.cpp
```

这样只会进行预编译，但是不会生成文件，可以使用 **-o** 重定向到文件，下面的几个步骤都可以使用 **-o** 重定向的文件

```
g++ -E main.cpp -o main.i
```

### （2）转换成汇编代码- S

预编译结束后，对文件内容进行词法分析、语法分析、语义分析以及优化，然后生成汇编代码

使用 **-S** 参数完成转换指定 **.i** 文件

```
g++ -S main.i
```

也可以之间将cpp转换成汇编代码

```
g++ -S main.cpp -o main.s
```

### （3）编译成机器码 -c

使用 **-c** 参数指定汇编文件，将生成的汇编代码编译成机器码，也称之为中间文件，windows下为 .obj文件，linux下为.o

```
g++ -c main.s
g++ -c main.s -o main.o
```

### （4）链接

将中间文件链接成可执行文件，此过程不需要使用参数

```
g++ main.o
g++ main.o -o main
g++ main.cpp
g++ -o main.exe main.cpp
```

- 若没有指定重定向的文件，则默认生成以 **a** 为名称的可执行文件；
- 也可以直接将C/C++的代码文件编译链接成可执行文件；
## 3、多文件编译

上面介绍的只是单文件的编译过程，若是多文件，则分别编译源文件，最后将中间文件（机器码）链接起来即可

**示例：**

假设有代码：aa.h/cpp、bb.h/cpp、main.cpp

```
g++ -c aa.cpp -o aa.o
g++ -c bb.cpp -o bb.o
g++ -c main.cpp -o main.o
```
最后链接
```
g++ aa.o bb.o main.o -o main
```
## 2、g++的其他参数

### （1）-Wall

使能所有的警告信息

```
g++ -Wall main.cpp -o main
```

### （2）-g

对程序进行调试，生成调试信息

```
g++ -g main.cpp -main
```

### （3）-w

忽略警告信息

```
g++ -w -Wall -o main main.cpp
```

### （4）-I

指定头文件查找目录，一般用于头文件和源文件不再同一个目录下

# 三、makefile

如果工程简单，只有单个或者几个文件，链接库也不多，使用gcc/g++编译即可，但是如果大项目，使用指令编译则多有不便，那么可以使用makefile，这也是开发大型项目的必备技能。

详细请参考makefile的相关文章