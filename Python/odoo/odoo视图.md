<font size=3>

# 说明

odoo使用xml视图渲染前端界面，视图大致分为：form、tree、图表、看板、日历、甘特、搜索等

示例：

```xml
<odoo>
	<data>
        <!-- 视图使用record包括 -->
    	<record id="视图唯一id" model="ir.ui.view">
            <field name="name">视图名称</field>
            <!-- 其他字段 -->
        </record>
    </data>
</odoo>
```

# 一、公共结构

- 每个视图都是一个 **\<record\>** ；
- 视图公共的结构和字段都使用 **field** 渲染；

**视图的公共结构：**

| 字段        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| name        | 必填，视图名称，只是用来在列表视图里面作为描述显示或者排序   |
| model       | 数据模型名，链接到数据模型                                   |
| priority    | 客户端可以通过 **id**，或者 **(model, type)**  请求视图。 对于后者， 将会搜索出所有正确类型和模型的视图，并且将返回最小 **priority** 编号的视图 (它是“默认视图”)。<br>**priority** 也定义了视图继承期间的应用顺序 |
| arch        | 视图布局的描述                                               |
| groups_id   | **Many2many** 字段允许查看/使用当前视图的分组                |
| inherit_id  | 当前视图继承的视图，默认不需要设置，除非需要继承             |
| mode        | 继承模型                                                     |
| application | 网站功能定义可切换的视图。默认情况下，始终应用该视图         |

# 二、tree视图



# 三、form视图

表单视图用于显示单条记录的数据

## 1、字段field

**field** 也可以用来渲染当前记录的单个字段，可能的属性包括

| 字段        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| name        | 必填，渲染的字段名                                           |
| widget      | 字段根据其内容渲染呈现，不同的类型呈现的方式不同，但是可以使用 **widget** 来指定一个别的方式来展示 |
| option      | JSON 对象指定字段窗口小部件的配置(包括默认的窗口小部件)      |
| class       | 用来改变字段的样式，                                         |
| groups      | 指定用户组可以看到该字段                                     |
| on_change   | 在字段值改变时调用对应方法，从8.0开始改用模型中的 odoo.api.onchange() |
| attrs       | 标签属性，只有两个：invisible和readonly                      |
| domain      | 在编辑时，当以 **下拉选择** 的方式选取  **关联字段**  时，过滤数据 |
| context     | 用于关联字段，显示数据时提供上下文环境                       |
| readonly    | 设置为0/1，表示该字段是否只读                                |
| required    | 设置为0/1，表示该字段是否为必填                              |
| nolabel     | 设置为0/1，表示是否显示该字段的标签，只有在该字段是group子元素时起效 |
| placeholder | 字段值为空时展示的提示                                       |
| mode        | 对于one2many字段，用于展示其关联的记录的形式，有tree, form, kanban , graph，默认是tree |
| help        | 当将鼠标放在字段或标签时显示的提示                           |
| filename    | 对于二进制的字段，相关字段给出文件名                         |
| password    | 表示该字段是一个密码，不明文展示                             |

**特殊说明：**

### （1）options

标签行为，用于指定widget字段配置的json对象。这与该字段使用什么widget来显示有关，odoo原生的字段类型都有对应的默认widget来负责显示，widget中封装了一些行为。可以查看具体widget定义的js文件，从 this.options.XX 字眼得到有哪些options。

​    我们也可以自定义widget、继承widget来增加选项

```xml
<field name="" options="{'no_create': 1, 'no_open': 1}"></field>
```

### （2）class

可能的值有：

| class类                   | 说明                                                         |
| ------------------------- | ------------------------------------------------------------ |
| oe_inline                 | 避免换行符后面的字段                                         |
| oe_left/oe_right          | 相当于css的float浮动，向左浮动布局、向右浮动布局             |
| oe_read_only/oe_edit_only | 只在相应的模式下显示<br>read_only的意思是只有在非编辑状态下才显示<br>edit_only是只有在编辑状态下显示 |
| oe_no_button              | 不为many2one字段显示导航按钮                                 |
| oe_avatar                 | 当该字段为图片时，将它展示为头像（90*90的正方形）            |

### （3）attrs

标签属性，值有两个：**invisible** 和 **readonly**

可以根据表达式值来决定该两个值，从而动态控制标签的显示/隐藏、只读/可修改。

 **使用方式一：**

```xml
<!-- 通过attrs属性统一设置，可以使用表达式进行动态设置 -->
<field name="" 
       attrs="{'invisible': [('state', '!=', 'draft'), ('state', '!=', 'disable')]}" />
```

**使用方式二：**

```xml
<!-- 直接通过属性名单独、明确设置 -->
<field name="" invisible="1" readonly="1"/>
```

## 2、结构组件

### （1）header

与 **sheet** 结合，在工作表上方预留着宽的位置，通常用于显示工作流的按钮和状态的小部件

### （2）sheet

**\<sheet\>** 直接用在 **\<form\>** 标签中，会展示一个美观的表单，其他的结构组件都可以用在 **\<sheet\>** 中

### （3）group

- 用在表单中定义列。默认情况下，组定义两列并且组的最直接子项采用单列。 **field** 组的直接子元素默认显示一个标题，标题和字段本身的列为1
- **group** 中的列数可以用 **col** 属性来计算，元素所用的列数可以用 **colspan** 属性来计算；
- 子元素的横向布局（试着在改变行之前填充下一列）
- **group** 分组可以有一个 **string** 属性，它显示为分组的标题；
- 可以使用 **\<separator\>** 元素添加组内分割线

### （4）newline

只用于 **group** 元素，提前结束当前行并立即切换到新行，即在组内一行还没布满时，强制换行布局

### （5）notebook

分页显示，定义一个 **tab** 块，内部使用多个 **tab** 标签定义每页

 **tab** 标签的属性有：

| 属性      | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| string    | 必填，该tab也的标题                                          |
| accesskey | html accesskey                                               |
| attrs     | 基于记录值的动态属性(可见、只读)，例如：attrs="{'invisible': [(表达式)]}" |

# 四、tree视图

列表视图，用于展示多条数据

## 1、字段field

- **\<tree\>** 元素的子元素；
- **field** 也可以用来渲染当前记录的单个字段；

可能的属性包括

| 字段      | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| name      | 字段名                                                       |
| string    | 该列头的文本名称，默认是字段名，可以在界面上自定义显示名     |
| invisible | 查询而且保存该字段，但界面上不显示                           |
| groups    | 可以看到该字段的用户组列表                                   |
| widget    | 段的展示形式                                                 |
| sum/avg   | 在底部显示基于当前页面数据的求和或平均值                     |
| attrs     | 基于记录值的动态属性<br>属性一般有两个：invisible\readonly，只对当前行有效，即可以第一条记录中该字段显示，第二条隐藏，由domain表达式决定 |

### （1）widget

字段显示的表示，可能的列表视图值包括

| widget值       | 说明                                  |
| -------------- | ------------------------------------- |
| progressbar    | 进度条用于展示浮点数                  |
| many2onebutton | 当关联字段值存在时显示勾，不存在显示X |
| handle         | 对于排序字段，直接显示向上向下箭头    |

## 2、按钮button

- **\<tree\>** 元素的子元素；
- 列表中可以使用 **button** 标签在单元格显示按钮；

**button** 标签可以有以下几种属性：

| 属性    | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| icon    | 图标，用于显示按钮                                           |
| string  | 没有 **icon** ，button显示的文字<br>有 **icon** ，当做alt属性值 |
| type    | 按钮的类型，提示如何点击它影响Odoo                           |
| name    | 按钮的响应函数、工作流信号、action_id                        |
| args    | 传递给响应函数的参数                                         |
| attrs   | 基于记录值的某个字段值，将domain表达式应用在该行字段值上，当返回值为True的时候设置相应的属性，一般属性有 invisible、readonly |
| states  | invisible属性attrs的简写，给出一个以逗号分隔的state列表，需要模型有一个对应的state属性，可以将不在state列表中的记录的按钮隐藏 |
| context | 作为额外的数据携带，在跳转、函数调用时传递过去               |
| confirm | 当点击按钮时给出的确认消息文字                               |

### （1）type

按钮的类型，提示如何点击它影响Odoo，可能的值有：

| type值   | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| workflow | 默认值，将按钮name作为信号发送给工作流，记录的内容作为参数   |
| object   | 调用当前数据列表模型的方法，方法名是按钮的name，调用时带有记录id和当前上下文环境 |
| action   | 加载ir.actions，按钮name是该action在数据库的id，上下文环境扩展到列表的model(作为active_model)、当前记录 |

## 3、\<tree\>标签

**\<tree\>** 标签的属性有：

| 属性                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| editable             | 默认情况下选择单行记录时会打开对应记录的表单<br>该属性让数据可以在列表内进行编辑<br>有效的值是top和bottom，可在列表的顶部或底部添加新记录 |
| default_order        | 重定义视图的排序规则，**以逗号分隔多个字段**，可使用desc来进行倒序<br>**<tree default_order="sequence,name desc">** |
| decoration-{*$name*} | 允许基于记录的属性更改行文本的样式                           |
| create/edit/delete   | 通过将相应的属性设置为 **false** 来 **禁用** 视图中的相应操作，创建/编辑/删除 |
| on_write             | 创建或编辑记录后，调用函数                                   |

### （1）decoration-{*$name*}

样式可为 :

**bf加粗, it斜体 或 其他bootstrap样式如：danger红色, info, muted, primary, success绿色,warning橙色等等**，**值为python表达式**，对每条记录执行相应表达式判断，当结果为true的时候将对应的样式应用。

​    也可以直接在标签的css样式值中使用表达式来动态设置，如设置颜色：

```xml
colors="gray:state=='cancel';red:state=='audit';green:state=='done';blue:state in('draft','confirm');"
```

### （2）on_write

- 只当启用editable时有用；
- 在tree视图新增或修改记录时，会自动调用on_write属性值对应对函数，并且会把新增/修改的记录作为参数传入，可以在该函数执行一些数据校验、唯一性校验；
- 该函数需要返回一个用于更新列表的记录id列表；

# 五、搜索视图

